manual_base = {
    "11.pdf":{
        "title": "THE MALARIA SITUATION IN THE PHILIPPINES WITH SPECIAL REFERENCE TO MOSQUITO VECTORS",
        "authors": ["NELIA P. SALAZAR","MARY ELIZABETH G. MIRANDA","MAXIMINO N. SANTOS", "LrLIAN A. DE LAS LLAGAS"],
        "country": "Philippines",
        "publish_year": "1988",
    },
    "12.pdf":{
        "title": "Stability of malaria in a community in Bataan, The Philippines: prospects for control",
        "authors": ["A. Saula", "V.Y Belizario", "M.D.G. Bustos", "F. Espino", "M.A. Lansang", "N.P. Salazar", "E. Torres"],
        "country": "Philippines",
        "publish_year": "1997",
    },
    "13.pdf":{
        "title": "Malaria in an area of low transmission in the Philippines",
        "authors": ["A. Saul", "M.A. Lansang"],
        "country": "Philippines",
        "publish_year": "1997",
    },
    "14.pdf":{
        "title": "APPLICATION OF SEROEPIDEMIOLOGY IN IDENTIFICATION OF LOCAL FOCI IN A MALARIOUS COMMUNITY IN PALAWAN, THE PHILIPPINES",
        "authors": ["PILARITA TONGOL-RIVERA", "SHIGEYUKI KANO", "EDITHA MIGUEL", "PURIFICACION TONGOL", "MAMORU SUZUKI"],
        "country": "Philippines",
        "publish_year": "1993",
    },
    "16.pdf":{
        "title": "Atovaquone-Proguanil for Falciparum Malaria in the Philippines",
        "authors": ["George Watt;Dorina Bustos", "David B. A. Hutchinson"],
        "country": "Philippines",
        "publish_year": "2000",
    },
    "19.pdf":{
        "title": "Sequence Variation in the 18S rRNA gene, a Target for PCR-Based Malaria Diagnosis, in Plasmodium ovale from Southern Vietnam",
        "authors": ["FUMIHIKO KAWAMOTO","HIROFUMI MIYAKE","OSAMU KANEKO", "MASATSUGU KIMURA", "NGUYEN THI DUNG", 
            "NGUYEN THE DUNG", "QING LIU", "MIAN ZHOU", "LE DUC DAO", "SHINTARO KAWAI", "SHIN ISOMURA", "YUSUKE WATAYA"],
        "country": "Philippines",
        "publish_year": "1996",
    },
    "196.pdf":{
        "title": "Short Communication: An assessment of the use of malaria rapid tests by village health volunteers in rural Laos",
        "authors": ["Mayfong Mayxay", "Paul N. Newton", "Shunmay Yeung", "Tiengkham Pongvongsa", "Samlane Phompida", "Rattanaxay Phetsouvanh", "Nicholas J. White"],
        "country": "Philippines",
        "publish_year": "2004",
    },
    "197.pdf":{
        "title": "A randomized comparison of oral chloroquine and sulfadoxine-pyrimethamine for the treatment of uncomplicated Plasmodium falciparum malaria in Lees",
        "authors": ["Mayfong Mayxay", "Rattanaxay Phetsouvanh", "Samlane Phompida", "Paul N. Newton", "Maniphone Khanthavong", 
            "Bouakham Vannachone", "Alan Brockman", "Nicholas J. White"],
        "country": "Thailand",
        "publish_year": "2003",
    },
    "22.pdf":{
        "title": "Parasight-F test to diagnose malaria in hypo-endemic and epidemic prone regions of Vietnam",
        "authors": ["P. Verle", "L. N. Binh", "T. T. Lieu", "P. T. Yen", "M. Coosemans"],
        "country": "Vietnam",
        "publish_year": "1996",
    },
    "26.pdf":{
        "title": "SHORT REPORT:IN VIVO SENSITIVITY OF PLASMODIUM FALCIPARUM TO HALOFANTRINE IN SOUTHERN CENTRAL VIETNAM",
        "authors": ["DOAN HANH NHAN", "WALTER R. J. TAYLOR", "NGUYEN DIEU THUONG", "TRAN THI UYEN", "DAVID J. FRYAUFF", "IKA SUSANTI",
            "EDUARDO GOMEZ-SALADIN", "LE DINH CONG", "J. KEVIN BAIRD"],
        "country": "Vietnam",
        "publish_year": "2003",
    }
}


auto_base = {
    "11.pdf":{
        "title": "THE MALARIA SITUATION IN THE PHILIPPINES WITH SPECIAL REFERENCE TO MOSQUITO VECTORS",
        "authors": ["NELIA P. SALAZAR","MARY ELIZABETH G. MIRANDA","MAXIMINO N. SANTOS", "LrLIAN A. DE LAS LLAGAS"],
        "country": "Philippines",
        "publish_year": "1988",
    },
    "12.pdf":{
        "title": "Stability of malaria in a community in Bataan, The Philippines: prospects for control",
        "authors": ["A. Saula", "V.Y Belizario", "M.D.G. Bustos", "F. Espino", "M.A. Lansang", "N.P. Salazar", "E. Torres"],
        "country": "Philippines",
        "publish_year": "1997",
    },
    "13.pdf":{
        "title": "Malaria in Low Endemic Areas: Why So Stable?",
        "authors": ["A. Saul", "M.A. Lansang"],
        "country": "Philippines",
        "publish_year": "",
    },
    "14.pdf":{
        "title": "Application of Seroepidemiology in Identification of Local Foci of Malaria in a Frontier Community in Palawan, The Philippines",
        "authors": ["PILARITA TONGOL-RIVERA", "SHIGEYUKI KANO", "EDITHA MIGUEL", "PURIFICACION TONGOL", "MAMORU SUZUKI"],
        "country": "Philippines",
        "publish_year": "1993",
    },
    "16.pdf":{
        "title": "Atovaquone-Proguanil for Falciparum Malaria in the Philippines",
        "authors": ["George Watt;Dorina Bustos", "David B. A. Hutchinson"],
        "country": "Philippines",
        "publish_year": "2000",
    },
    "19.pdf":{
        "title": "Plasmodium ovale infection in southern Vietnam: a study of the prevalence, diagnosis, and molecular biology of the parasite using field samples",
        "authors": ["FUMIHIKO KAWAMOTO","HIROFUMI MIYAKE","OSAMU KANEKO", "MASATSUGU KIMURA", "NGUYEN THI DUNG", 
            "NGUYEN THE DUNG", "QING LIU", "MIAN ZHOU", "LE DUC DAO", "SHINTARO KAWAI", "SHIN ISOMURA", "YUSUKE WATAYA"],
        "country": "Philippines",
        "publish_year": "1996",
    },
    "196.pdf":{
        "title": "Short Communication: An assessment of the use of malaria rapid tests by village health volunteers in rural Laos",
        "authors": ["Mayfong Mayxay", "Paul N. Newton", "Shunmay Yeung", "Tiengkham Pongvongsa", "Samlane Phompida", "Rattanaxay Phetsouvanh", "Nicholas J. White"],
        "country": "Philippines",
        "publish_year": "2004",
    },
    "197.pdf":{
        "title": "A randomized comparison of oral chloroquine and sulfadoxine-pyrimethamine for the treatment of uncomplicated Plasmodium falciparum malaria in Lees",
        "authors": ["Mayfong Mayxay", "Rattanaxay Phetsouvanh", "Samlane Phompida", "Paul N. Newton", "Maniphone Khanthavong", 
            "Bouakham Vannachone", "Alan Brockman", "Nicholas J. White"],
        "country": "Thailand",
        "publish_year": "2003",
    },
    "22.pdf":{
        "title": "Parasight-F test to diagnose malaria in hypo-endemic and epidemic prone regions of Vietnam",
        "authors": ["P. Verle", "L. N. Binh", "T. T. Lieu", "P. T. Yen", "M. Coosemans"],
        "country": "Vietnam",
        "publish_year": "1996",
    },
    "26.pdf":{
        "title": "Halofantrine Sensitivity Testing in Vietnamese Patients With Plasmodium Falciparum or Mixed Plasmodium Falciparum/Plasmodium Vivax Malaria",
        "authors": ["DOAN HANH NHAN", "WALTER R. J. TAYLOR", "NGUYEN DIEU THUONG", "TRAN THI UYEN", "DAVID J. FRYAUFF", "IKA SUSANTI",
            "EDUARDO GOMEZ-SALADIN", "LE DINH CONG", "J. KEVIN BAIRD"],
        "country": "Vietnam",
        "publish_year": "2003",
    }
}


import json
import math
import re
from collections import Counter

WORD = re.compile(r"\w+")

def text_to_vector(text):
    words = WORD.findall(text)
    return Counter(words)

def get_cosine(text1, text2):
    text11 = text1.lower()
    text21 = text2.lower()
    vec1 = text_to_vector(text11)
    vec2 = text_to_vector(text21)
    intersection = set(vec1.keys()) & set(vec2.keys())
    numerator = sum([vec1[x] * vec2[x] for x in intersection])
    sum1 = sum([vec1[x] ** 2 for x in list(vec1.keys())])
    sum2 = sum([vec2[x] ** 2 for x in list(vec2.keys())])
    denominator = math.sqrt(sum1) * math.sqrt(sum2)
    if not denominator:
        return 0.0
    else:
        return float(numerator) / denominator

def eval_coss(d1, d2):
    res = {}
    for pdf,values in d1.items():
        for k,v in values.items():
            if k!="authors":
                if pdf in res.keys():
                    res[pdf][k] = get_cosine(v, d2[pdf][k])
                else:
                    res[pdf] = {}
                    res[pdf][k] = get_cosine(v, d2[pdf][k])
            else:
                if pdf in res.keys():
                    res[pdf][k] = get_cosine(";".join(v), ";".join(d2[pdf][k]))
                else:
                    res[pdf] = {}
                    res[pdf][k] = get_cosine(";".join(v), ";".join(d2[pdf][k]))
    with open("eval.json", "w+") as f:
        json.dump(res, f, indent = 4)


if __name__ == '__main__':
    eval_coss(manual_base, auto_base)